<app-layout title="Usuários">
    <app-message [message]="message"></app-message>
    <app-loading [loading]="loading"></app-loading>
    <app-card-form *ngIf="mode == 'new' || mode == 'edit'">
        <form [formGroup]="form" (submit)="onSubmit()">
            <div class="row align-items-end">
                <div class="col-md-6 mb-3">
                    <div class="form-group">
                        <label for="name">
                            <i class="fas fa-id-badge"></i> Nome
                        </label>
                        <input id="name" formControlName="name" type="text" class="form-control" required
                            placeholder="Nome">
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="form-group">
                        <label for="email">
                            <i class="fas fa-envelope"></i> Email
                        </label>
                        <input id="email" formControlName="email" type="email" class="form-control" maxlength="100"
                            placeholder="Email">
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="form-group">
                        <label for="username">
                            <i class="fas fa-user"></i> Usuário
                        </label>
                        <input id="username" formControlName="username" type="text" class="form-control" maxlength="100"
                            placeholder="Usuário">
                    </div>
                </div>
                <div class="col-md-3 mb-3" *ngIf="user?.visibility == 1">
                    <div class="form-group">
                        <label for="department_id">
                            <i class="fas fa-building"></i> Departamento
                        </label>
                        <div class="input-group">
                            <select id="department_id" formControlName="department_id" class="form-control">
                                <option value="" disabled selected>Selecione um departamento</option>
                                <option *ngFor="let department of departments" [value]="department.id">
                                    {{ department.name }}
                                </option>
                            </select>
                            <button type="button" class="btn btn-success" (click)="openModalDepartment()">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="form-group">
                        <label for="type">
                            <i class="fas fa-eye"></i> Visibilidade
                        </label>
                        <select class="form-select" formControlName="visibility">
                            <option value="1">Administrador</option>
                            <option value="2">Gerente</option>
                            <option value="3">Operacional</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3 mb-3" *ngIf="mode == 'new'">
                    <div class="form-group">
                        <label for="password">
                            <i class="fas fa-user"></i> Senha
                        </label>
                        <input id="password" formControlName="password" type="password" class="form-control"
                            maxlength="100" placeholder="Senha de acesso">
                    </div>
                </div>
                <div class="col-md-3 mb-3" *ngIf="mode == 'new'">
                    <div class="form-group">
                        <label for="password_confirmation">
                            <i class="fas fa-user"></i> Confirmação de senha
                        </label>
                        <input id="password_confirmation" formControlName="password_confirmation" type="password"
                            class="form-control" maxlength="100" placeholder="Confirmar senha">
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <app-button-submit></app-button-submit>
                </div>
            </div>
        </form>
        <app-messages-validators [backendErrors]="backendErrors"></app-messages-validators>
    </app-card-form>
    <app-table [itens]="users" [cols]="cols" path="/users" [pages]="pages" (showEvent)="show($event)"
        (deleteEvent)="delete($event)"></app-table>
</app-layout>

<div class="modal" id="departmentModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title fs-5">Novo departamento</div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="formDepartment" (submit)="onSubmitDepartment()">
                    <div class="mb-3">
                        <div class="form-group">
                            <label for="name">
                                <i class="fas fa-tag"></i> Nome
                            </label>
                            <input id="name" formControlName="name" type="text" class="form-control" placeholder="Nome"
                                required />
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-group">
                            <label for="description">
                                <i class="fas fa-info-circle"></i> Descrição (Opcional)
                            </label>
                            <input id="description" formControlName="description" type="text" class="form-control"
                                maxlength="100" placeholder="Descrição (Máximo 100 caracteres).">
                        </div>
                    </div>
                    <app-messages-validators [backendErrors]="backendDepartmentErrors"></app-messages-validators>
                    <app-button-submit></app-button-submit>
                </form>
            </div>
        </div>
    </div>
</div>